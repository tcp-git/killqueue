QQ Queue System (generated scaffold)

ไฟล์ในโปรเจ็กต์นี้คือ scaffold แบบง่ายสำหรับระบบคิวที่อธิบายใน `ui.md`/`readme.md`:

- `server.js` — Express API ที่ให้ endpoints สำหรับดึง/อัพเดตสถานะคิว
- `db/init.sql` — สคริปต์ SQL สำหรับสร้างฐานข้อมูล `qq` และตาราง `queue_items`
- `db/seed.js` — สคริปต์ Node.js ที่จะสร้างตาราง (จาก `init.sql`) และเติม 20 ช่อง (5x4)
- `public/index.html` — หน้า Caller (หน้าพนักงาน) ที่เลือก/เรียก/ยกเลิก/ข้าม
- `public/display.html` — หน้า Display (หน้าจอ TV) ที่แสดงผลกระพริบและเล่นเสียงเมื่อถูกเรียก

การติดตั้งและรัน (บน macOS / Linux / Windows ที่มี Node.js และ MySQL):

1) ติดตั้ง dependencies

```bash
npm install
```

2) สร้าง DB และเติมข้อมูลตัวอย่าง (สองทางเลือก)

Option A (ใช้ mysql client):

```bash
mysql -u supervisor -p saas < db/init.sql
node db/seed.js
```

Option B (ถ้า user มีสิทธิ์สร้าง DB):

```bash
node db/seed.js
```

#+ คู่มือแบบง่ายสำหรับผู้ใช้ (ไม่จำเป็นต้องมีพื้นฐาน)

นี่คือคำอธิบายแบบทีละขั้นตอน เพื่อช่วยให้ผู้ที่ไม่มีพื้นฐานทางเทคนิคสามารถนำโปรเจ็กต์นี้ไปรันบนเครื่องของตัวเองได้

สรุปสั้น ๆ ของไฟล์สำคัญ:

- `server.js` — โปรแกรมเซิร์ฟเวอร์ (Node.js / Express) ที่ให้บริการ API
- `db/init.sql` — สคริปต์ SQL สำหรับสร้างฐานข้อมูลและตารางเริ่มต้น
- `db/seed.js` — สคริปต์ตัวอย่างที่จะเติมข้อมูลตัวอย่าง (20 หมายเลข)
- `public/index.html` — หน้าจอสำหรับพนักงาน (Caller)
#+ คู่มือแบบง่ายสำหรับผู้ใช้ (ไม่จำเป็นต้องมีพื้นฐาน)

นี่คือคำอธิบายแบบทีละขั้นตอน เพื่อช่วยให้ผู้ที่ไม่มีพื้นฐานทางเทคนิคสามารถนำโปรเจ็กต์นี้ไปรันบนเครื่องของตัวเองได้

สรุปสั้น ๆ ของไฟล์สำคัญ:

- `server.js` — โปรแกรมเซิร์ฟเวอร์ (Node.js / Express) ที่ให้บริการ API
- `db/init.sql` — สคริปต์ SQL สำหรับสร้างฐานข้อมูลและตารางเริ่มต้น
- `db/seed.js` — สคริปต์ตัวอย่างที่จะเติมข้อมูลตัวอย่าง (20 หมายเลข)
- `public/index.html` — หน้าจอสำหรับพนักงาน (Caller)
- `public/display.html` — หน้าจอสำหรับแสดงผล (Display)

หากต้องการให้คนไม่ชำนาญติดตั้ง โปรดทำตามขั้นตอนด้านล่างตามลำดับ

1) สิ่งที่ต้องเตรียม (Prerequisites)

- คอมพิวเตอร์ (Windows / macOS / Linux)
- ติดตั้ง Node.js เวอร์ชัน 16+ (ดาวน์โหลดจาก https://nodejs.org)
- ติดตั้ง MySQL หรือ MariaDB และรู้ข้อมูลล็อกอิน (host, user, password)

2) เปิดโปรแกรมที่ใช้พิมพ์คำสั่ง (Terminal / Command Prompt)

3) ติดตั้งโปรแกรมที่โปรเจ็กต์ต้องการ (ครั้งเดียว)

```bash
# อยู่ในโฟลเดอร์โปรเจ็กต์ (ที่มี package.json)
npm install
```

4) สร้างฐานข้อมูลและเติมข้อมูลตัวอย่าง

มีสองทางเลือก ขึ้นกับว่าคุณเข้าถึง MySQL อย่างไร:

Option A — ถ้าคุณมีโปรแกรม `mysql` (client) และ credential ตามตัวอย่าง:

```bash
mysql -u supervisor -p saas < db/init.sql
node db/seed.js
```

Option B — ถ้าคุณไม่ต้องการเรียก `mysql` ด้วยตนเอง ให้ใช้สคริปต์ seed (สคริปต์จะพยายามสร้าง DB ถ้าสามารถทำได้):

```bash
node db/seed.js
```

ถ้าการเชื่อมต่อฐานข้อมูลไม่สำเร็จ ให้เปิดไฟล์ `server.js` และ `db/seed.js` ด้วยโปรแกรมแก้ไขข้อความ (เช่น Notepad, TextEdit, VS Code) และแก้ค่า host/user/password ให้ตรงกับข้อมูล MySQL ของคุณ

5) เริ่มระบบ (รันเซิร์ฟเวอร์)

```bash
npm start
```

เมื่อเซิร์ฟเวอร์รันสำเร็จ คุณจะเห็นข้อความแจ้งพอร์ต (โดยปกติคือ 8080)

6) เปิดหน้าเรียกใช้งานในเว็บเบราว์เซอร์

- หน้า Caller (พนักงาน): http://localhost:8080/index.html
- หน้า Display (หน้าจอทีวี): http://localhost:8080/display.html

7) สิ่งที่ควรตรวจสอบถ้าไม่เห็นหน้าเว็บ

- ตรวจสอบว่าเซิร์ฟเวอร์รันอยู่ (ใน Terminal จะมีข้อความว่า "Listening" หรือ "Server started")
- หากพอร์ต 8080 ถูกใช้งาน ให้ปิดโปรแกรมอื่นที่ใช้พอร์ตนั้นหรือแก้ `PORT` ก่อนรัน เช่น `PORT=8081 npm start`
- หากมีปัญหาเชื่อมต่อ MySQL จะมีข้อความแสดงข้อผิดพลาด ให้ตรวจสอบ user/password/host ใน `server.js` และว่า MySQL กำลังทำงานอยู่หรือไม่

8) ไฟล์เสียงเรียกคิว

วางไฟล์เสียง `dingdong.mp3` ในโฟลเดอร์ `public/` (`public/dingdong.mp3`) หากไม่มีเสียงเมื่อเรียก ให้ตรวจสอบว่าชื่อไฟล์ตรงและเบราว์เซ์ร์อนุญาตให้เล่นเสียง (บางครั้งต้องคลิกหน้าจอก่อน)

9) คำสั่งทดสอบ (optional)

หลังสตาร์ทเซิร์ฟเวอร์ คุณสามารถรันทดสอบแบบง่ายได้ (ถ้ามีสคริปต์):

```bash
npm test
```


10) ปัญหาทั่วไปและการแก้ไขอย่างรวดเร็ว

- npm start ขึ้น Exit Code 1: มักเกิดจาก dependency หาย ลองรัน `npm install` อีกครั้ง
- MySQL connection refused: ตรวจสอบว่า MySQL ทำงาน และ credentials ถูกต้อง
- หน้าไม่กระพริบ/ไม่มีเสียง: ตรวจสอบ `public/dingdong.mp3` และการตั้งค่าเสียงของเบราว์เซอร์

การตั้งค่าโดยใช้ไฟล์ `.env` (กำหนดพอร์ตและการเชื่อมต่อ DB)

คุณสามารถตั้งค่าตัวแปรสภาพแวดล้อมโดยสร้างไฟล์ `.env` ในโฟลเดอร์โปรเจ็กต์ ถ้าต้องการตัวอย่างให้คัดลอกไฟล์ที่เตรียมไว้:

```bash
cp .env.example .env
# แก้ไข .env ด้วย text editor (Notepad, TextEdit, VS Code) เพื่อเปลี่ยนค่า PORT หรือค่าการเชื่อมต่อฐานข้อมูล
```

ตัวอย่าง `.env` ที่สำคัญ:

```text
PORT=8080
DB_HOST=127.0.0.1
DB_USER=supervisor
DB_PASSWORD=saas
DB_NAME=qq
```

หมายเหตุ:
- โค้ด `server.js` จะโหลดค่าจาก `process.env.PORT` (หรือใช้พอร์ต 8080 เป็นค่าเริ่มต้น)
- ถ้าตั้ง `PORT` ใน `.env` แล้ว เรียก `npm start` ปกติ โปรแกรมจะใช้พอร์ตที่กำหนด
- หลังเพิ่ม `.env` คุณอาจต้องแก้ `db/seed.js` หรือ `server.js` ถ้าสคริปต์ใช้ค่าการเชื่อมต่อภายในไฟล์แทนตัวแปร `process.env` (ผมสามารถช่วยอัปเดตให้ใช้ตัวแปรจาก `.env` ถ้าต้องการ)


ปัญหาพิเศษ — พอร์ต 8080 ถูกใช้งาน (EADDRINUSE)

อาการ
- เมื่อรัน `npm start` คุณเห็นข้อผิดพลาดแบบนี้:

	Error: listen EADDRINUSE: address already in use :::8080

สาเหตุ
- มีโปรเซสอื่นกำลังฟังที่พอร์ต 8080 (เช่น Apache/httpd, ข้อความแสดงว่า `httpd` หรือโปรแกรมอื่น)

วิธีตรวจสอบโปรเซสที่ใช้งานพอร์ต 8080

```bash
lsof -nP -iTCP:8080 -sTCP:LISTEN
# หรือ (macOS) ถ้าต้องการ sudo:
# sudo lsof -i :8080
```

คำอธิบายผลลัพธ์
- ผลลัพธ์จะแสดงคอลัมน์ `COMMAND` (โปรแกรม) และ `PID` (หมายเลขโปรเซส)
- ตัวอย่างที่พบบ่อย: `httpd` (Apache) หรือโปรเซสอื่นๆ

วิธีแก้ (เลือกวิธีใดวิธีหนึ่งตามสะดวก)

1) หยุดบริการที่เป็นสาเหตุ (recommended ถ้าเป็น httpd ที่คุณไม่ต้องการใช้งาน):

```bash
# ถ้าติดตั้ง httpd ผ่าน Homebrew
brew services stop httpd

# ถ้าเป็น Apache ใน macOS built-in
sudo apachectl stop
```

2) ฆ่า process โดยใช้ PID (ถ้าจำเป็น)

```bash
# แทน <PID> ด้วยหมายเลข PID ที่ได้จาก lsof
sudo kill <PID>

# ถ้ายังไม่หยุด (ใช้เมื่อจำเป็นจริงๆ)
sudo kill -9 <PID>
```

3) ทางเลี่ยง (ไม่ต้องหยุดโปรเซสอื่น) — รันแอปบนพอร์ตอื่นชั่วคราว

```bash
# macOS / Linux / PowerShell (POSIX shell):
PORT=8081 npm start

# Windows PowerShell (ตัวอย่าง):
$env:PORT=8081; npm start
```

หลังแก้ไข
- ลองรัน `npm start` ใหม่อีกครั้ง เมื่อสำเร็จ คุณควรเห็นข้อความว่าเซิร์ฟเวอร์เริ่มทำงานและสามารถเปิด
	`http://localhost:8080/index.html` (หรือพอร์ตที่คุณตั้ง) ได้

ข้อควรระวัง
- หลีกเลี่ยงการ `kill -9` กับบริการระบบที่สำคัญโดยไม่แน่ใจว่ามีผลกระทบอย่างไร
- ถ้าพบว่าโปรเซสเป็นบริการที่ควรทำงาน (เช่น Nginx/Apache ที่โฮสต์ไซต์อื่น) พิจารณารันแอปบนพอร์ตอื่นหรือปรับการตั้งค่าบริการนั้น


11) ถ้าคุณต้องการให้ผมช่วยรันคำสั่งเหล่านี้ให้ (ผมสามารถรัน `npm install`, `node db/seed.js`, `npm start` ให้) — แจ้งผมได้เลยว่าต้องการให้ผมรันคำสั่งใดบ้าง

เพิ่มเติม: ถ้าคุณต้องการผมสามารถทำ

- สร้างไฟล์ `.env.example` หรือสอนวิธีแก้ค่า DB ทีละขั้นตอนแบบรูปภาพ
- ย้ายไฟล์ภาพ/เสียง ไปเก็บในโฟลเดอร์ `project/` และอัปเดต `readme.md`

